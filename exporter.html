<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Texture Pack Exporter</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; max-width: 880px; margin: 40px auto; padding: 0 16px; line-height: 1.45; }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    label { display:block; font-weight:600; margin:10px 0 4px; }
    input, select, button { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; }
    button { background:#111; color:#fff; cursor:pointer; }
    button:disabled { opacity:.6; cursor:not-allowed; }
    .inline { display:flex; gap:12px; align-items:center; }
    .card { border:1px solid #eee; border-radius:12px; padding:12px; display:flex; justify-content:space-between; align-items:center; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
    .muted { color:#666; font-size:.9rem; }
    .error { color:#b00020; margin-top: 10px; }
    .success { background:#f7f7f7; padding:12px; border-radius:10px; }
    .links { display:flex; gap:10px; }
  </style>
</head>
<body>
  <h1>Texture Pack Exporter</h1>
  <p>Send any image URL to the texture-service and get downloadable PNG/TGA in power-of-two sizes.</p>

  <label>Image URL</label>
  <input id="imageUrl" placeholder="https://example.com/image.png" />

  <div class="row">
    <div>
      <label>Pack</label>
      <input id="pack" placeholder="Characters" value="Characters" />
    </div>
    <div>
      <label>Race</label>
      <input id="race" placeholder="Human" value="Human" />
    </div>
  </div>

  <label>Label</label>
  <input id="label" placeholder="DesertRogue" value="Sample" />

  <div class="row">
    <div>
      <label>Sizes (comma-separated PoT)</label>
      <input id="sizes" value="512,1024,2048,4096" />
    </div>
    <div>
      <label>Mode</label>
      <select id="mode">
        <option value="fit" selected>fit (pad transparency)</option>
        <option value="crop">crop (fill frame)</option>
        <option value="stretch">stretch (force)</option>
      </select>
    </div>
  </div>

  <div class="inline" style="margin:12px 0 6px;">
    <label style="margin:0;">Formats</label>
    <label class="inline" style="font-weight:400;"><input type="checkbox" id="fmtPng" checked /> PNG</label>
    <label class="inline" style="font-weight:400;"><input type="checkbox" id="fmtTga" checked /> TGA</label>
    <label class="inline" style="font-weight:400;"><input type="checkbox" id="pow2" /> pow2 round</label>
  </div>

  <button id="go">Export Texture Pack</button>
  <div id="err" class="error"></div>

  <div id="out" style="margin-top:20px;"></div>

<script>
const BTN = document.getElementById('go');
const ERR = document.getElementById('err');
const OUT = document.getElementById('out');

async function exportPack() {
  ERR.textContent = '';
  OUT.innerHTML = '';
  BTN.disabled = true;

  try {
    const imageUrl = document.getElementById('imageUrl').value.trim();
    const pack = document.getElementById('pack').value.trim();
    const race = document.getElementById('race').value.trim();
    const label = document.getElementById('label').value.trim();
    const sizes = document.getElementById('sizes').value.trim() || '512,1024,2048,4096';
    const mode = document.getElementById('mode').value;
    const fmt = [
      document.getElementById('fmtPng').checked ? 'png' : null,
      document.getElementById('fmtTga').checked ? 'tga' : null
    ].filter(Boolean).join(',');
    const pow2 = document.getElementById('pow2').checked ? '1' : '0';

    if (!imageUrl) throw new Error('Please paste an image URL.');

    const qs = new URLSearchParams({
      formats: fmt || 'png,tga',
      sizes, mode, pow2, pack, race, label
    }).toString();

    const url = 'https://web-production-ec376.up.railway.app/profile/gameasset?' + qs;

    const res = await fetch(url, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ imageUrl })
    });
    if (!res.ok) throw new Error('Service error ' + res.status);

    const json = await res.json(); // { ok, results: { png: {512:{url,...}}, tga:{...} } }

    const makeGroup = (title, dict) => {
      if (!dict || !Object.keys(dict).length) return '';
      const entries = Object.entries(dict).sort((a,b)=>Number(a[0])-Number(b[0]));
      return `
        <div class="success">
          <h3>${title}</h3>
          ${entries.map(([size,info]) => `
            <div class="card">
              <div>
                <div class="mono">${size}Ã—${size}</div>
                <div class="muted">${info.mb ?? ''} MB</div>
              </div>
              <div class="links">
                <a href="${info.url}" target="_blank" rel="noreferrer">Open</a>
                <button onclick="navigator.clipboard.writeText('${info.url}')">Copy URL</button>
              </div>
            </div>
          `).join('')}
        </div>`;
    };

    OUT.innerHTML = `
      <h2>Texture Pack Ready</h2>
      ${makeGroup('PNG', json.results.png)}
      ${makeGroup('TGA', json.results.tga)}
    `;
  } catch (e) {
    ERR.textContent = e.message || String(e);
  } finally {
    BTN.disabled = false;
  }
}

BTN.addEventListener('click', exportPack);
</script>
</body>
</html>
